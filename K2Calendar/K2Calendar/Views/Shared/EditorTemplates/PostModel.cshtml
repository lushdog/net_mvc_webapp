@model K2Calendar.Models.PostModel
@{
    string existingTags = "";
    if(Model.Tags != null || Model.Tags.Count > 0)  
    {
        System.Text.StringBuilder prePopulate = new System.Text.StringBuilder("prePopulate: [ \n");
        foreach(var tag in Model.Tags)
        {
            string tagString = string.Format(@"{{id:{0}, name:""{1}""}},", tag.Id, tag.Name);
            prePopulate.Append(tagString);
        }
        prePopulate.Remove(prePopulate.Length-1,1); //remove trailing comma
        prePopulate.Append("]");
        existingTags = prePopulate.ToString();        
    }
}

@Html.LabelFor(model => model.Title)
@Html.TextBoxFor(model => model.Title)
@Html.ValidationMessageFor(model => model.Title)
@Html.LabelFor(model => model.Description)
@Html.TextAreaFor(model => model.Description, new { rows = "10" })
@Html.ValidationMessageFor(model => model.Description)
@Html.LabelFor(model => model.RankId, "Rank")
@Html.DropDownListFor(m => m.RankId, (SelectList)ViewBag.RankList)
@Html.LabelFor(model => model.EventDate)
@Html.TextBoxFor(model => model.EventDate, new { placeholder = "mm/dd/yyyy" })
@Html.ValidationMessageFor(model => model.EventDate)
@Html.LabelFor(model => model.VideoUrl)
@Html.TextBoxFor(model => model.VideoUrl)
@Html.ValidationMessageFor(model => model.VideoUrl)
@Html.LabelFor(model => model.Tags)
@Html.ValidationMessageFor(model => model.TagsInput)
<input data-val="true" data-val-required="The Tags field is required." type="text" id="TagsInput" name="TagsInput" />
<script type="text/javascript">
    $(document).ready(function () {
        $("#TagsInput").tokenInput("/Post/SearchTags", {
            allowFreeTagging: true,
            preventDuplicates: true,
            hintText: "e.g. 'armbar' 'back mount' 'Barrhaven' ...",
            noResultsText: "Nothing found. Press <Enter> to add this new tag.",
            searchingText: "Searching...",
            @Html.Raw(existingTags)          
        });
    });
</script>
<br />
<br />
